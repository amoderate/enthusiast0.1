<html><head><meta charset="UTF-8"><link rel="import" href="shop-app.html"></head><body><div hidden="" by-vulcanize=""><dom-module id="paper-card" assetpath="../bower_components/paper-card/">
  <template>
    <style include="paper-material">
      :host {
        display: inline-block;
        position: relative;
        box-sizing: border-box;
        background-color: var(--paper-card-background-color, --primary-background-color);
        border-radius: 2px;

        @apply(--paper-font-common-base);
        @apply(--paper-card);
      }

      /* IE 10 support for HTML5 hidden attr */
      [hidden] {
        display: none !important;
      }

      .header {
        position: relative;
        border-top-left-radius: inherit;
        border-top-right-radius: inherit;
        overflow: hidden;

        @apply(--paper-card-header);
      }

      .header iron-image {
        display: block;
        width: 100%;
        --iron-image-width: 100%;
        pointer-events: none;

        @apply(--paper-card-header-image);
      }

      .header .title-text {
        padding: 16px;
        font-size: 24px;
        font-weight: 400;
        color: var(--paper-card-header-color, #000);

        @apply(--paper-card-header-text);
      }

      .header .title-text.over-image {
        position: absolute;
        bottom: 0px;

        @apply(--paper-card-header-image-text);
      }

      :host ::content .card-content {
        padding: 16px;
        position:relative;

        @apply(--paper-card-content);
      }

      :host ::content .card-actions {
        border-top: 1px solid #e8e8e8;
        padding: 5px 16px;
        position:relative;

        @apply(--paper-card-actions);
      }
    </style>

    <div class="header">
      <iron-image hidden$="[[!image]]" aria-hidden$="[[_isHidden(image)]]" src="[[image]]" alt="[[alt]]" placeholder="[[placeholderImage]]" preload="[[preloadImage]]" fade="[[fadeImage]]"></iron-image>
      <div hidden$="[[!heading]]" class$="title-text [[_computeHeadingClass(image)]]">[[heading]]</div>
    </div>

    <content></content>
  </template>

  <script>Polymer({is:"paper-card",properties:{heading:{type:String,value:"",observer:"_headingChanged"},image:{type:String,value:""},alt:{type:String},preloadImage:{type:Boolean,value:!1},fadeImage:{type:Boolean,value:!1},placeholderImage:{type:String,value:null},elevation:{type:Number,value:1,reflectToAttribute:!0},animatedShadow:{type:Boolean,value:!1},animated:{type:Boolean,reflectToAttribute:!0,readOnly:!0,computed:"_computeAnimated(animatedShadow)"}},_isHidden:function(e){return e?"false":"true"},_headingChanged:function(e){this.getAttribute("aria-label");this.setAttribute("aria-label",e)},_computeHeadingClass:function(e){return e?" over-image":""},_computeAnimated:function(e){return e}});</script>
</dom-module>
</div><dom-module id="shop-list">

  <template>

    <style include="shop-common-styles">

      .hero-image {
        position: relative;
        height: 320px;
        overflow: hidden;
        margin-bottom: 32px;
      }

      .hero-image {
        --shop-image-img: {
          position: absolute;
          top: 0;
          bottom: 0;
          left: -9999px;
          right: -9999px;
          max-width: none;
        };
      }

      .grid {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        @apply(--layout-justified);
        margin: 0 10px 32px 10px;
        padding: 0;
        list-style: none;
      }

      .grid li {
        -webkit-flex: 1 1;
        flex: 1 1;
        -webkit-flex-basis: 33%;
        flex-basis: 33%;
        max-width: 33%;
      }

      .grid a {
        display:block;
        text-decoration: none;
      }

      google-map {
        height: 600px;
      }

      #content {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        margin: 0 10px 32px 10px;

      }
      .tab-layout {
        @apply(--layout-block);
        @apply(--layout-self-center);

        width: 75%;
        max-width: 700px;
        transition: opacity 0.4s;
        opacity: 1;
      }

      .layout-center {
        @apply(--layout-block);
        @apply(--layout-self-center);

        width: 75%;
        max-width: 700px;
        transition: opacity 0.4s;
        opacity: 1;
      }

      paper-tabs {
        @apply(--layout-block);
        @apply(--layout-self-center);
        --paper-tab-ink: #E57373;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        width: 45%;
        text-transform: uppercase;
        margin-bottom: 3px;
      }

      paper-tab.iron-selected {
        color: #E57373;

      }

      paper-tab {
      --paper-tab-ink: #E57373;
      }

      #repostButton {
        font-weight: bold;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);;
      }


      @media (max-width: 767px) {
        .hero-image {
          display: none;
        }
        .grid{
          @apply(--layout-vertical);
          margin: 0 0px 32px 0px;

        }


        .grid li {
          -webkit-flex: 1 1;
          flex: 1 1;
          -webkit-flex-basis: 33%;
          flex-basis: 33%;
          max-width: 33%;
        }


        .grid  li {
          -webkit-flex-basis: 100%;
          flex-basis: 100%;
          max-width: 100%;
        }

        .logo {
          text-align: center;
          @apply(--layout-center);
          padding-left: 7px;
        }

        paper-tabs {
          @apply(--layout-center);
          font-family: 'Roboto', 'Noto', sans-serif;
          -webkit-font-smoothing: antialiased;
          width: 75%;
          text-transform: uppercase;
          margin-bottom: 1px;
        }
      }

    </style>

    
    <app-route route="[[route]]" pattern="/:category" data="{{routeData}}">
    </app-route>

    <firebase-auth id="auth" user="{{user}}" provider="google" on-error="showError">
    </firebase-auth>
    <shop-category-data id="categoryData" category-name="[[routeData.category]]" category="{{category}}" failure="{{failure}}">
    </shop-category-data>

    <firebase-query id="query" path="/items" data="{{itemList}}" order-by-child="/theme" start-at="[[category.title]]" end-at="[[category.title]]">
    </firebase-query>

    <firebase-query id="geo" path="/geo/[[category.title]]" data="{{geo}}" limit-to-first="30">
    </firebase-query>

    <firebase-query path="/users/[[user.uid]]/favorite" order-by-child="/itemid" data="{{favoriteList}}">
    </firebase-query>


    <shop-image alt="[[category.title]]" src="[[category.image]]" placeholder-img="[[category.placeholder]]" class="hero-image"></shop-image>


    <header>
      <h1>[[category.title]]</h1>
      <span>[[_getPluralizedQuantity(itemList.length)]]</span>
        <div id="content">
          <paper-tabs selected="{{selected}}" no-bar="">
              <paper-tab>Photos  写真</paper-tab>
              <paper-tab>Maps  地図</paper-tab>
          </paper-tabs>
      </div>
    </header>


    <iron-pages selected="{{selected}}">

      <div>
          <div class="layout horizontal center-justified">
            <ul class="grid" hidden$="[[failure]]">
              <template is="dom-repeat" items="{{itemList}}" as="item" hidden$="[[failure]]">
                <li>
                  <div>
                      <a href$="[[_getItemHref(item)]]"><shop-list-menu item="[[item]]"></shop-list-menu></a>
                      <div hidden$="[[_shared(item.userFavorites)]]">
                        <paper-button id="repostButton" on-tap="repostItem">add to favorites</paper-button>
                      </div>
                      <div hidden$="[[!_shared(item.userFavorites)]]">
                        <paper-button disabled="" id="repostButton" on-tap="repostItem">already added to favorites</paper-button>
                      </div>
                </div>
                </li>
              </template>
            </ul>
          </div>
      </div>
      <div>
        <google-map id="map" map="{{map}}" latitude="35.6895" longitude="139.6917" api-key="AIzaSyA_tK6zo3FBiuiXoXocS_-qLTS0KDyVd5E" zoom="15 " fit-to-markers="" style="transit-layer">
          <template is="dom-repeat" items="{{geo}}" as="geo" hidden$="[[failure]]">
            <google-map-marker map="[[map]]" latitude="{{geo.lat}}" longitude="{{geo.lng}}" draggable="false"></google-map-marker>
          </template>
        </google-map>
      </div>
    </iron-pages>

  </template>

  <script>Polymer({is:"shop-list",properties:{category:Object,route:Object,routeData:Object,items:Object,visible:Boolean,shared:{type:Boolean},offline:{type:Boolean,observer:"_offlineChanged"},failure:Boolean},observers:["_categoryChanged(category, visible)","_modeChanged(category)"],_getListItems:function(e){return e||[{},{},{},{},{},{},{},{},{},{}]},repostItem:function(e){var t=e.model.item;console.log(t),console.log("was clicked");var o=firebase.auth().currentUser,i={},r={};if(null!=o.uid){var n={user:o.uid};r["/items/"+t.itemid+"/userFavorites/"+o.uid+"/"]=n,firebase.database().ref().update(r);var s={itemLng:t.itemLat,itemLat:t.itemLng,itemName:t.itemName,shopAddres:t.shopAddres,shopId:t.shopId,shopName:t.shopName,shopNameUnique:t.shopNameUnique,shopPhone:t.shopPhone,shopTags:t.shopsTags,theme:t.theme,url:t.url,user:t.user,itemid:t.itemid};i["/users/"+o.uid+"/favorite/"+t.itemid+"/"]=s,firebase.database().ref().update(i)}},_getItemHref:function(e){return e.shopName?["/detail",e.shopNameUnique,e.itemName,e.itemid].join("/"):null},_getPluralizedQuantity:function(e){if(!e)return"";var t=1===e?"item":"items";return"("+e+" "+t+")"},_categoryChanged:function(e,t){t&&this.debounce("change-section",function(){this.fire("change-section",{category:e.name,title:e.title})})},_modeChanged:function(e){this.debounce("change-shop",function(){this.fire("change-shop",{shopName:"EXPLORE"})})},_tryReconnect:function(){this.$.categoryData.refresh()},_offlineChanged:function(e){e||this._tryReconnect()},_shared:function(e){return currentUser=firebase.auth().currentUser,console.log(currentUser.uid),console.log(e),console.log(e[currentUser.uid]),currentUser.uid in e}});</script>

</dom-module>
</body></html>