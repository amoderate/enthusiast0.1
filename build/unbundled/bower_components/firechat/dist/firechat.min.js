(function(){var e=this,t=e._,n=Array.prototype,a=Object.prototype,r=Function.prototype,i=n.push,s=n.slice,o=n.concat,c=a.toString,l=a.hasOwnProperty,u=Array.isArray,h=Object.keys,f=r.bind,d=function(e){return e instanceof d?e:this instanceof d?void(this._wrapped=e):new d(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=d),exports._=d):e._=d,d.VERSION="1.7.0";var p=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,r){return e.call(t,n,a,r)};case 4:return function(n,a,r,i){return e.call(t,n,a,r,i)}}return function(){return e.apply(t,arguments)}};d.iteratee=function(e,t,n){return null==e?d.identity:d.isFunction(e)?p(e,t,n):d.isObject(e)?d.matches(e):d.property(e)},d.each=d.forEach=function(e,t,n){if(null==e)return e;t=p(t,n);var a,r=e.length;if(r===+r)for(a=0;r>a;a++)t(e[a],a,e);else{var i=d.keys(e);for(a=0,r=i.length;r>a;a++)t(e[i[a]],i[a],e)}return e},d.map=d.collect=function(e,t,n){if(null==e)return[];t=d.iteratee(t,n);for(var a,r=e.length!==+e.length&&d.keys(e),i=(r||e).length,s=Array(i),o=0;i>o;o++)a=r?r[o]:o,s[o]=t(e[a],a,e);return s};var m="Reduce of empty array with no initial value";d.reduce=d.foldl=d.inject=function(e,t,n,a){null==e&&(e=[]),t=p(t,a,4);var r,i=e.length!==+e.length&&d.keys(e),s=(i||e).length,o=0;if(arguments.length<3){if(!s)throw new TypeError(m);n=e[i?i[o++]:o++]}for(;s>o;o++)r=i?i[o]:o,n=t(n,e[r],r,e);return n},d.reduceRight=d.foldr=function(e,t,n,a){null==e&&(e=[]),t=p(t,a,4);var r,i=e.length!==+e.length&&d.keys(e),s=(i||e).length;if(arguments.length<3){if(!s)throw new TypeError(m);n=e[i?i[--s]:--s]}for(;s--;)r=i?i[s]:s,n=t(n,e[r],r,e);return n},d.find=d.detect=function(e,t,n){var a;return t=d.iteratee(t,n),d.some(e,function(e,n,r){return t(e,n,r)?(a=e,!0):void 0}),a},d.filter=d.select=function(e,t,n){var a=[];return null==e?a:(t=d.iteratee(t,n),d.each(e,function(e,n,r){t(e,n,r)&&a.push(e)}),a)},d.reject=function(e,t,n){return d.filter(e,d.negate(d.iteratee(t)),n)},d.every=d.all=function(e,t,n){if(null==e)return!0;t=d.iteratee(t,n);var a,r,i=e.length!==+e.length&&d.keys(e),s=(i||e).length;for(a=0;s>a;a++)if(r=i?i[a]:a,!t(e[r],r,e))return!1;return!0},d.some=d.any=function(e,t,n){if(null==e)return!1;t=d.iteratee(t,n);var a,r,i=e.length!==+e.length&&d.keys(e),s=(i||e).length;for(a=0;s>a;a++)if(r=i?i[a]:a,t(e[r],r,e))return!0;return!1},d.contains=d.include=function(e,t){return null!=e&&(e.length!==+e.length&&(e=d.values(e)),d.indexOf(e,t)>=0)},d.invoke=function(e,t){var n=s.call(arguments,2),a=d.isFunction(t);return d.map(e,function(e){return(a?t:e[t]).apply(e,n)})},d.pluck=function(e,t){return d.map(e,d.property(t))},d.where=function(e,t){return d.filter(e,d.matches(t))},d.findWhere=function(e,t){return d.find(e,d.matches(t))},d.max=function(e,t,n){var a,r,i=-1/0,s=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:d.values(e);for(var o=0,c=e.length;c>o;o++)a=e[o],a>i&&(i=a)}else t=d.iteratee(t,n),d.each(e,function(e,n,a){r=t(e,n,a),(r>s||r===-1/0&&i===-1/0)&&(i=e,s=r)});return i},d.min=function(e,t,n){var a,r,i=1/0,s=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:d.values(e);for(var o=0,c=e.length;c>o;o++)a=e[o],i>a&&(i=a)}else t=d.iteratee(t,n),d.each(e,function(e,n,a){r=t(e,n,a),(s>r||1/0===r&&1/0===i)&&(i=e,s=r)});return i},d.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:d.values(e),a=n.length,r=Array(a),i=0;a>i;i++)t=d.random(0,i),t!==i&&(r[i]=r[t]),r[t]=n[i];return r},d.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=d.values(e)),e[d.random(e.length-1)]):d.shuffle(e).slice(0,Math.max(0,t))},d.sortBy=function(e,t,n){return t=d.iteratee(t,n),d.pluck(d.map(e,function(e,n,a){return{value:e,index:n,criteria:t(e,n,a)}}).sort(function(e,t){var n=e.criteria,a=t.criteria;if(n!==a){if(n>a||void 0===n)return 1;if(a>n||void 0===a)return-1}return e.index-t.index}),"value")};var _=function(e){return function(t,n,a){var r={};return n=d.iteratee(n,a),d.each(t,function(a,i){var s=n(a,i,t);e(r,a,s)}),r}};d.groupBy=_(function(e,t,n){d.has(e,n)?e[n].push(t):e[n]=[t]}),d.indexBy=_(function(e,t,n){e[n]=t}),d.countBy=_(function(e,t,n){d.has(e,n)?e[n]++:e[n]=1}),d.sortedIndex=function(e,t,n,a){n=d.iteratee(n,a,1);for(var r=n(t),i=0,s=e.length;s>i;){var o=i+s>>>1;n(e[o])<r?i=o+1:s=o}return i},d.toArray=function(e){return e?d.isArray(e)?s.call(e):e.length===+e.length?d.map(e,d.identity):d.values(e):[]},d.size=function(e){return null==e?0:e.length===+e.length?e.length:d.keys(e).length},d.partition=function(e,t,n){t=d.iteratee(t,n);var a=[],r=[];return d.each(e,function(e,n,i){(t(e,n,i)?a:r).push(e)}),[a,r]},d.first=d.head=d.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:s.call(e,0,t)},d.initial=function(e,t,n){return s.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},d.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},d.rest=d.tail=d.drop=function(e,t,n){return s.call(e,null==t||n?1:t)},d.compact=function(e){return d.filter(e,d.identity)};var v=function(e,t,n,a){if(t&&d.every(e,d.isArray))return o.apply(a,e);for(var r=0,s=e.length;s>r;r++){var c=e[r];d.isArray(c)||d.isArguments(c)?t?i.apply(a,c):v(c,t,n,a):n||a.push(c)}return a};d.flatten=function(e,t){return v(e,t,!1,[])},d.without=function(e){return d.difference(e,s.call(arguments,1))},d.uniq=d.unique=function(e,t,n,a){if(null==e)return[];d.isBoolean(t)||(a=n,n=t,t=!1),null!=n&&(n=d.iteratee(n,a));for(var r=[],i=[],s=0,o=e.length;o>s;s++){var c=e[s];if(t)s&&i===c||r.push(c),i=c;else if(n){var l=n(c,s,e);d.indexOf(i,l)<0&&(i.push(l),r.push(c))}else d.indexOf(r,c)<0&&r.push(c)}return r},d.union=function(){return d.uniq(v(arguments,!0,!0,[]))},d.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,a=0,r=e.length;r>a;a++){var i=e[a];if(!d.contains(t,i)){for(var s=1;n>s&&d.contains(arguments[s],i);s++);s===n&&t.push(i)}}return t},d.difference=function(e){var t=v(s.call(arguments,1),!0,!0,[]);return d.filter(e,function(e){return!d.contains(t,e)})},d.zip=function(e){if(null==e)return[];for(var t=d.max(arguments,"length").length,n=Array(t),a=0;t>a;a++)n[a]=d.pluck(arguments,a);return n},d.object=function(e,t){if(null==e)return{};for(var n={},a=0,r=e.length;r>a;a++)t?n[e[a]]=t[a]:n[e[a][0]]=e[a][1];return n},d.indexOf=function(e,t,n){if(null==e)return-1;var a=0,r=e.length;if(n){if("number"!=typeof n)return a=d.sortedIndex(e,t),e[a]===t?a:-1;a=0>n?Math.max(0,r+n):n}for(;r>a;a++)if(e[a]===t)return a;return-1},d.lastIndexOf=function(e,t,n){if(null==e)return-1;var a=e.length;for("number"==typeof n&&(a=0>n?a+n+1:Math.min(a,n+1));--a>=0;)if(e[a]===t)return a;return-1},d.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var a=Math.max(Math.ceil((t-e)/n),0),r=Array(a),i=0;a>i;i++,e+=n)r[i]=e;return r};var g=function(){};d.bind=function(e,t){var n,a;if(f&&e.bind===f)return f.apply(e,s.call(arguments,1));if(!d.isFunction(e))throw new TypeError("Bind must be called on a function");return n=s.call(arguments,2),a=function(){if(!(this instanceof a))return e.apply(t,n.concat(s.call(arguments)));g.prototype=e.prototype;var r=new g;g.prototype=null;var i=e.apply(r,n.concat(s.call(arguments)));return d.isObject(i)?i:r}},d.partial=function(e){var t=s.call(arguments,1);return function(){for(var n=0,a=t.slice(),r=0,i=a.length;i>r;r++)a[r]===d&&(a[r]=arguments[n++]);for(;n<arguments.length;)a.push(arguments[n++]);return e.apply(this,a)}},d.bindAll=function(e){var t,n,a=arguments.length;if(1>=a)throw new Error("bindAll must be passed function names");for(t=1;a>t;t++)n=arguments[t],e[n]=d.bind(e[n],e);return e},d.memoize=function(e,t){var n=function(a){var r=n.cache,i=t?t.apply(this,arguments):a;return d.has(r,i)||(r[i]=e.apply(this,arguments)),r[i]};return n.cache={},n},d.delay=function(e,t){var n=s.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},d.defer=function(e){return d.delay.apply(d,[e,1].concat(s.call(arguments,1)))},d.throttle=function(e,t,n){var a,r,i,s=null,o=0;n||(n={});var c=function(){o=n.leading===!1?0:d.now(),s=null,i=e.apply(a,r),s||(a=r=null)};return function(){var l=d.now();o||n.leading!==!1||(o=l);var u=t-(l-o);return a=this,r=arguments,0>=u||u>t?(clearTimeout(s),s=null,o=l,i=e.apply(a,r),s||(a=r=null)):s||n.trailing===!1||(s=setTimeout(c,u)),i}},d.debounce=function(e,t,n){var a,r,i,s,o,c=function(){var l=d.now()-s;t>l&&l>0?a=setTimeout(c,t-l):(a=null,n||(o=e.apply(i,r),a||(i=r=null)))};return function(){i=this,r=arguments,s=d.now();var l=n&&!a;return a||(a=setTimeout(c,t)),l&&(o=e.apply(i,r),i=r=null),o}},d.wrap=function(e,t){return d.partial(t,e)},d.negate=function(e){return function(){return!e.apply(this,arguments)}},d.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,a=e[t].apply(this,arguments);n--;)a=e[n].call(this,a);return a}},d.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},d.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},d.once=d.partial(d.before,2),d.keys=function(e){if(!d.isObject(e))return[];if(h)return h(e);var t=[];for(var n in e)d.has(e,n)&&t.push(n);return t},d.values=function(e){for(var t=d.keys(e),n=t.length,a=Array(n),r=0;n>r;r++)a[r]=e[t[r]];return a},d.pairs=function(e){for(var t=d.keys(e),n=t.length,a=Array(n),r=0;n>r;r++)a[r]=[t[r],e[t[r]]];return a},d.invert=function(e){for(var t={},n=d.keys(e),a=0,r=n.length;r>a;a++)t[e[n[a]]]=n[a];return t},d.functions=d.methods=function(e){var t=[];for(var n in e)d.isFunction(e[n])&&t.push(n);return t.sort()},d.extend=function(e){if(!d.isObject(e))return e;for(var t,n,a=1,r=arguments.length;r>a;a++){t=arguments[a];for(n in t)l.call(t,n)&&(e[n]=t[n])}return e},d.pick=function(e,t,n){var a,r={};if(null==e)return r;if(d.isFunction(t)){t=p(t,n);for(a in e){var i=e[a];t(i,a,e)&&(r[a]=i)}}else{var c=o.apply([],s.call(arguments,1));e=new Object(e);for(var l=0,u=c.length;u>l;l++)a=c[l],a in e&&(r[a]=e[a])}return r},d.omit=function(e,t,n){if(d.isFunction(t))t=d.negate(t);else{var a=d.map(o.apply([],s.call(arguments,1)),String);t=function(e,t){return!d.contains(a,t)}}return d.pick(e,t,n)},d.defaults=function(e){if(!d.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var a=arguments[t];for(var r in a)void 0===e[r]&&(e[r]=a[r])}return e},d.clone=function(e){return d.isObject(e)?d.isArray(e)?e.slice():d.extend({},e):e},d.tap=function(e,t){return t(e),e};var b=function(e,t,n,a){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var r=c.call(e);if(r!==c.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]===e)return a[i]===t;var s=e.constructor,o=t.constructor;if(s!==o&&"constructor"in e&&"constructor"in t&&!(d.isFunction(s)&&s instanceof s&&d.isFunction(o)&&o instanceof o))return!1;n.push(e),a.push(t);var l,u;if("[object Array]"===r){if(l=e.length,u=l===t.length)for(;l--&&(u=b(e[l],t[l],n,a)););}else{var h,f=d.keys(e);if(l=f.length,u=d.keys(t).length===l)for(;l--&&(h=f[l],u=d.has(t,h)&&b(e[h],t[h],n,a)););}return n.pop(),a.pop(),u};d.isEqual=function(e,t){return b(e,t,[],[])},d.isEmpty=function(e){if(null==e)return!0;if(d.isArray(e)||d.isString(e)||d.isArguments(e))return 0===e.length;for(var t in e)if(d.has(e,t))return!1;return!0},d.isElement=function(e){return!(!e||1!==e.nodeType)},d.isArray=u||function(e){return"[object Array]"===c.call(e)},d.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},d.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){d["is"+e]=function(t){return c.call(t)==="[object "+e+"]"}}),d.isArguments(arguments)||(d.isArguments=function(e){return d.has(e,"callee")}),"function"!=typeof/./&&(d.isFunction=function(e){return"function"==typeof e||!1}),d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},d.isNaN=function(e){return d.isNumber(e)&&e!==+e},d.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===c.call(e)},d.isNull=function(e){return null===e},d.isUndefined=function(e){return void 0===e},d.has=function(e,t){return null!=e&&l.call(e,t)},d.noConflict=function(){return e._=t,this},d.identity=function(e){return e},d.constant=function(e){return function(){return e}},d.noop=function(){},d.property=function(e){return function(t){return t[e]}},d.matches=function(e){var t=d.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var a=0;n>a;a++){var r=t[a],i=r[0];if(r[1]!==e[i]||!(i in e))return!1}return!0}},d.times=function(e,t,n){var a=Array(Math.max(0,e));t=p(t,n,1);for(var r=0;e>r;r++)a[r]=t(r);return a},d.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},d.now=Date.now||function(){return(new Date).getTime()};var y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=d.invert(y),x=function(e){var t=function(t){return e[t]},n="(?:"+d.keys(e).join("|")+")",a=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,a.test(e)?e.replace(r,t):e}};d.escape=x(y),d.unescape=x(w),d.result=function(e,t){if(null!=e){var n=e[t];return d.isFunction(n)?e[t]():n}};var R=0;d.uniqueId=function(e){var t=++R+"";return e?e+t:t},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,T=function(e){return"\\"+k[e]};d.template=function(e,t,n){!t&&n&&(t=n),t=d.defaults({},t,d.templateSettings);var a=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),r=0,i="__p+='";e.replace(a,function(t,n,a,s,o){return i+=e.slice(r,o).replace(I,T),r=o+t.length,n?i+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":a?i+="'+\n((__t=("+a+"))==null?'':__t)+\n'":s&&(i+="';\n"+s+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var s=new Function(t.variable||"obj","_",i)}catch(e){throw e.source=i,e}var o=function(e){return s.call(this,e,d)},c=t.variable||"obj";return o.source="function("+c+"){\n"+i+"}",o},d.chain=function(e){var t=d(e);return t._chain=!0,t};var F=function(e){return this._chain?d(e).chain():e};d.mixin=function(e){d.each(d.functions(e),function(t){var n=d[t]=e[t];d.prototype[t]=function(){var e=[this._wrapped];return i.apply(e,arguments),F.call(this,n.apply(d,e))}})},d.mixin(d),d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];d.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],F.call(this,n)}}),d.each(["concat","join","slice"],function(e){var t=n[e];d.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return d})}).call(this),this.FirechatDefaultTemplates=this.FirechatDefaultTemplates||{},this.FirechatDefaultTemplates["templates/layout-full.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div id='firechat' class='full'>\n<div id='firechat-header' class='clearfix'>\n<div class='clearfix'><div class='half firechat-dropdown' style=''>\n<a id='firechat-btn-rooms' class='firechat-dropdown-toggle btn full' data-toggle=\"firechat-dropdown\" href='#'>\n<span class='icon user-chat'></span>\nChat Rooms\n<span class='caret'></span>\n</a>\n<div class='firechat-dropdown-menu full' role='menu'><ul id='firechat-room-list'></ul><div class='firechat-dropdown-footer aligncenter'>\n<button type='button' class='btn twothird center' id='firechat-btn-create-room-prompt'>Create Room</button>\n</div></div></div>\n<div class='half firechat-dropdown' style=''>\n<a data-event='firechat-user-search-btn' class='btn full firechat-dropdown-toggle' data-toggle=\"firechat-dropdown\" href='#'>\n<span class='icon user-group'></span>\nVisitors\n<span class='caret'></span>\n</a>\n<div class='firechat-dropdown-menu' role='menu'>\n<div class='firechat-dropdown-header aligncenter clearfix'>\n<div class='search-wrapper'>\n<span class='icon search'></span>\n<input type='text' data-event='firechat-user-search' data-template='templates/user-search-list-item.html' data-target='firechat-user-search' data-controls='firechat-user-search-controls' class='center fivesixth'>\n</div>\n</div>\n<ul id='firechat-user-search'></ul><div class='firechat-dropdown-footer aligncenter clearfix'>\n<div id='firechat-user-search-controls' class='clearfix'>\n<span class=\"quarter\"></span>\n<button type='button' class='btn half' data-event='firechat-user-search' data-toggle='firechat-pagination-next' data-template='templates/user-search-list-item.html' data-target='firechat-user-search' data-controls='firechat-user-search-controls' disabled=disabled>Next</button>\n</div><label class='center full'>\n<small>Use \"+ Invite\" button within chat rooms for regular invites.</small>\n</label>\n</div>\n</div>\n</div>\n</div>\n</div>\n<div id='firechat-tabs' class='clearfix'>\n<ul id='firechat-tab-list' class='nav nav-tabs clearfix'></ul>\n<div id='firechat-tab-content' class='tab-content'></div>\n</div><div id='firechat-footer' class='clearfix'></div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/layout-popout.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div id='firechat' class='full'>\n<div id='firechat-tabs' class='clearfix'>\n<ul id='firechat-tab-list' class='nav nav-tabs clearfix'></ul>\n<div id='firechat-tab-content' class='tab-content'></div>\n</div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/message-context-menu.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div data-toggle='firechat-contextmenu' class='contextmenu' data-message-id='"+__e(id)+"'>\n<ul>\n<li><a href='#!' data-event='firechat-user-warn'>Warn User</a></li>\n",allowKick&&(__p+="\n<li><a href='#!' data-event='firechat-user-kick'>Kick User</a></li>\n"),__p+="\n<li><a href='#!' data-event='firechat-user-suspend-hour'>Suspend User (1 Hour)</a></li>\n<li><a href='#!' data-event='firechat-user-suspend-day'>Suspend User (1 Day)</a></li>\n<li><a href='#!' data-event='firechat-message-delete'>Delete Message</a></li>\n</ul>\n</div>";return __p},this.FirechatDefaultTemplates["templates/message.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div class='message message-"+__e(type)+" ",isSelfMessage&&(__p+=" message-self "),__p+="' data-message-id='"+__e(id)+"' data-user-id='"+__e(userId)+"' data-user-name='"+__e(name)+"' data-class=\"firechat-message\">\n<div class='clearfix'>\n<label class='fourfifth'>\n<strong class='name' title='"+__e(name)+"'>"+__e(name)+"</strong>\n<em>("+__e(localtime)+")</em>:\n</label>",disableActions||(__p+="\n<label class='fifth alignright'>\n<a href='#!' data-event='firechat-user-chat' class='icon user-chat' title='Invite to Private Chat'>&nbsp;</a>\n<a href='#!' data-event='firechat-user-mute-toggle' class='icon user-mute' title='Mute User'>&nbsp;</a>\n</label>\n"),__p+="</div>\n<div class='clearfix message-content'>\n"+(null==(__t=message)?"":__t)+"\n</div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-alert.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h6>"+__e(message)+"</h6>\n<p class='clearfix'>\n<button type='button' class='btn quarter right close'>Close</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-create-room.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='clearfix'>\n<h6>Give your chat room a name:</h6>\n<input data-input='firechat-room-name' type='text' placeholder='Room name...' style='margin-bottom: 5px;' maxlength='"+__e(maxLengthRoomName)+"'>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-invitation.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(fromUserName)+"</h5>\n<p>invited you to join</p>\n<h5>"+__e(toRoomName)+"</h5>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Accept</button>\n<button data-toggle='decline' type='button' class='btn'>Decline</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-invite-private.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h6>Invite <strong>"+__e(userName)+"</strong> to "+__e(roomName)+"?</h6>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Invite</button>\n<button data-toggle='decline' type='button' class='close btn'>Cancel</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-invite-reply.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(toUserName)+"</h5>\n<p>\n",__p+="accepted"===status?" accepted your invite. ":" declined your invite. ",__p+="\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt-user-mute.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='aligncenter clearfix'>\n<h5>"+__e(userName)+"</h5>\n<p class='clearfix'>\n<button data-toggle='accept' type='button' class='btn'>Mute</button>\n<button data-toggle='decline' type='button' class='btn'>Cancel</button>\n</p>\n</div>";return __p},this.FirechatDefaultTemplates["templates/prompt.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div class='prompt hidden'>\n<div class='prompt-header'>\n"+__e(title)+"\n<a href='#!' class='close right'>X</a>\n</div>\n<div class='prompt-body clearfix'>\n"+(null==(__t=content)?"":__t)+"\n</div>\n<div class='prompt-footer'></div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/room-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-room-type='"+__e(type)+"' data-room-id='"+__e(id)+"' data-room-name='"+__e(name)+"'>\n<a href='#!' class='clearfix ",isRoomOpen&&(__p+=" highlight "),__p+="'>\n<span class='left' title='"+__e(name)+"'>"+__e(name)+"</span>\n</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/room-user-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a href='#!' class='clearfix'>\n<span class='left twothird clipped' title='"+__e(name)+"'>"+__e(name)+"</span>",disableActions||(__p+="\n<span data-event='firechat-user-mute-toggle' class='icon user-mute right ",isMuted&&(__p+=" red "),__p+="' title='Toggle User Mute'>&nbsp;</span>\n<span data-event='firechat-user-chat' class='icon user-chat right' title='Invite to Private Chat'>&nbsp;</span>\n"),__p+="\n</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/room-user-search-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a href='#!' class='clearfix'>\n",__p+=disableActions?"\n<span class='left fourfifth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n":"\n<span data-event='firechat-user-invite' class='left fourfifth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n<span data-event='firechat-user-invite' class='icon plus right' title='Invite to Room'>+</span>\n",__p+="\n</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/tab-content.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<div id='"+__e(id)+"' data-room-id='"+__e(id)+"' class='tab-pane'>\n<div class='tab-pane-menu clearfix'><div class='firechat-dropdown twofifth'>\n<a data-event='firechat-user-room-list-btn' class='full btn firechat-dropdown-toggle' data-toggle=\"firechat-dropdown\" href='#' data-target='firechat-room-user-list-"+__e(id)+"'>\n<span class='icon user-group'></span>\nIn Room\n<span class='caret'></span>\n</a>\n<div class='firechat-dropdown-menu' role='menu'>\n<ul id='firechat-room-user-list-"+__e(id)+"' class='full'></ul>\n</div>\n</div><div class='firechat-dropdown twofifth'>\n<a data-event='firechat-user-search-btn' class='full btn firechat-dropdown-toggle' data-toggle=\"firechat-dropdown\" href='#'>\n<span class='icon plus'>+</span>\nInvite\n<span class='caret'></span>\n</a><div class='firechat-dropdown-menu' role='menu'>\n<div class='firechat-dropdown-header aligncenter clearfix'>\n<div class='search-wrapper'>\n<span class='icon search'></span>\n<input type='text' data-event='firechat-user-search' data-template='templates/room-user-search-list-item.html' data-target='firechat-room-user-search-"+__e(id)+"' data-controls='firechat-room-user-search-controls-"+__e(id)+"' class='center fivesixth'>\n</div>\n</div>\n<ul id='firechat-room-user-search-"+__e(id)+"'></ul><div class='firechat-dropdown-footer aligncenter clearfix'>\n<div id='firechat-room-user-search-controls-"+__e(id)+"' class='clearfix'><span class=\"quarter\"></span>\n<!--\n<button type='button' class='btn third disabled' data-event='firechat-user-search' data-template='templates/room-user-search-list-item.html' data-target='firechat-room-user-search-"+__e(id)+"' data-controls='firechat-room-user-search-controls-"+__e(id)+"' data-toggle='firechat-pagination-prev' disabled=disabled>Prev</button>\n-->\n<button type='button' class='btn half disabled' data-event='firechat-user-search' data-template='templates/room-user-search-list-item.html' data-target='firechat-room-user-search-"+__e(id)+"' data-controls='firechat-room-user-search-controls-"+__e(id)+"' data-toggle='firechat-pagination-next'  disabled=disabled>Next</button>\n</div>\n</div>\n</div>\n</div><a href='#!' data-event='firechat-close-tab' class='icon close right' style='15px 5px' title='Leave Room'></a></div><div class='clearfix'>\n<div id='firechat-messages"+__e(id)+"' class='chat'></div>\n</div><div class='clearfix'>\n<label>Your message:</label>\n<textarea id='textarea"+__e(id)+"' placeholder='Type your message here...'></textarea>\n</div>\n</div>";return __p},this.FirechatDefaultTemplates["templates/tab-menu-item.html"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<li data-room-id='"+__e(id)+"'>\n<a href='#"+__e(id)+"' data-toggle='firechat-tab' title='"+__e(name)+"'>"+__e(name)+"</a>\n</li>";return __p},this.FirechatDefaultTemplates["templates/user-search-list-item.html"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj)__p+="<li data-user-id='"+__e(id)+"' data-user-name='"+__e(name)+"'>\n<a href='#!' class='clearfix'>\n",__p+=disableActions?"\n<span class='left fivesixth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n":"\n<span data-event='firechat-user-chat' class='left fivesixth clipped' title='"+__e(name)+"'>"+__e(name)+"</span>\n<span data-event='firechat-user-chat' class='icon user-chat right' title='Invite to Private Chat'>&nbsp;</span>\n",__p+="\n</a>\n</li>";return __p},function(e){Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,a=function(){},r=function(){return n.apply(this instanceof a&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return a.prototype=this.prototype,r.prototype=new a,r}),Object.keys=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}}(),function(){function e(e,t){this._firechatRef=e,this._firebaseApp=e.database.app,this._user=null,this._userId=null,this._userName=null,this._isModerator=!1,this._sessionId=null,this._events={},this._rooms={},this._presenceBits={},this._userRef=null,this._messageRef=this._firechatRef.child("room-messages"),this._roomRef=this._firechatRef.child("room-metadata"),this._privateRoomRef=this._firechatRef.child("room-private-metadata"),this._moderatorsRef=this._firechatRef.child("moderators"),this._suspensionsRef=this._firechatRef.child("suspensions"),this._usersOnlineRef=this._firechatRef.child("user-names-online"),this._options=t||{},this._options.numMaxMessages=this._options.numMaxMessages||50}var t=this,n=t.Firechat;e.noConflict=function(){return t.Firechat=n,e},t.Firechat=e,e.prototype={_loadUserMetadata:function(e){var n=this;this._userRef.transaction(function(e){if(!e||!e.id||!e.name)return{id:n._userId,name:n._userName}},function(a,r,i){n._user=i.val(),n._moderatorsRef.child(n._userId).once("value",function(a){n._isModerator=!!a.val(),t.setTimeout(e,0)})})},_setupDataEvents:function(){var e=this._firechatRef.root.child(".info/connected");e.on("value",function(e){if(e.val()===!0)for(var t in this._presenceBits){var n=this._presenceBits[t],a=n.ref;a.onDisconnect().set(n.offlineValue),a.set(n.onlineValue)}},this),this._queuePresenceOperation(this._sessionRef,!0,null);var t=this._usersOnlineRef.child(this._userName.toLowerCase()),n=t.child(this._sessionId);this._queuePresenceOperation(n,{id:this._userId,name:this._userName},null),this._userRef.on("value",this._onUpdateUser,this),this._userRef.child("invites").on("child_added",this._onFirechatInvite,this),this._userRef.child("notifications").on("child_added",this._onNotification,this)},_addEventCallback:function(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)},_getEventCallbacks:function(e){return this._events.hasOwnProperty(e)?this._events[e]:[]},_invokeEventCallbacks:function(e){var t=[],n=this._getEventCallbacks(e);Array.prototype.push.apply(t,arguments),t=t.slice(1);for(var a=0;a<n.length;a+=1)n[a].apply(null,t)},_queuePresenceOperation:function(e,t,n){e.onDisconnect().set(n),e.set(t),this._presenceBits[e.toString()]={ref:e,onlineValue:t,offlineValue:n}},_removePresenceOperation:function(e,t){var n=e.toString();e.onDisconnect().cancel(),e.set(t),delete this._presenceBits[n]},_onUpdateUser:function(e){this._user=e.val(),this._userName=this._user.name,this._invokeEventCallbacks("user-update",this._user)},_onAuthRequired:function(){this._invokeEventCallbacks("auth-required")},_onEnterRoom:function(e){this._invokeEventCallbacks("room-enter",e)},_onNewMessage:function(e,t){var n=t.val();n.id=t.key,this._invokeEventCallbacks("message-add",e,n)},_onRemoveMessage:function(e,t){var n=t.key;this._invokeEventCallbacks("message-remove",e,n)},_onLeaveRoom:function(e){this._invokeEventCallbacks("room-exit",e)},_onNotification:function(e){var t=e.val();t.read||(("suspension"!==t.notificationType||t.data.suspendedUntil<(new Date).getTime())&&e.ref.child("read").set(!0),this._invokeEventCallbacks("notification",t))},_onFirechatInvite:function(e){var t=this,n=e.val();n.status||(n.id=n.id||e.key,t.getRoom(n.roomId,function(e){n.toRoomName=e.name,t._invokeEventCallbacks("room-invite",n)}))},_onFirechatInviteResponse:function(e){var t=e.val();t.id=t.id||e.key,this._invokeEventCallbacks("room-invite-response",t)}},e.prototype.setUser=function(e,n,a){var r=this;r._firebaseApp.auth().onAuthStateChanged(function(i){
i?(r._userId=e.toString(),r._userName=n.toString(),r._userRef=r._firechatRef.child("users").child(r._userId),r._sessionRef=r._userRef.child("sessions").push(),r._sessionId=r._sessionRef.key,r._loadUserMetadata(function(){t.setTimeout(function(){a(r._user),r._setupDataEvents()},0)})):r.warn("Firechat requires an authenticated Firebase reference. Pass an authenticated reference before loading.")})},e.prototype.resumeSession=function(){this._userRef.child("rooms").once("value",function(e){var t=e.val();for(var n in t)this.enterRoom(t[n].id)},function(){},this)},e.prototype.on=function(e,t){this._addEventCallback(e,t)},e.prototype.createRoom=function(e,t,n){var a=this,r=this._roomRef.push(),i={id:r.key,name:e,type:t||"public",createdByUserId:this._userId,createdAt:firebase.database.ServerValue.TIMESTAMP};"private"===t&&(i.authorizedUsers={},i.authorizedUsers[this._userId]=!0),r.set(i,function(e){e||a.enterRoom(r.key),n&&n(r.key)})},e.prototype.enterRoom=function(e){var t=this;t.getRoom(e,function(n){var a=n.name;if(e&&a&&!t._rooms[e]){if(t._rooms[e]=!0,t._user){t._userRef.child("rooms").child(e).set({id:e,name:a,active:!0});var r=t._firechatRef.child("room-users").child(e).child(t._userId).child(t._sessionId);t._queuePresenceOperation(r,{id:t._userId,name:t._userName},null)}t._onEnterRoom({id:e,name:a}),t._roomRef.child(e).once("value",function(n){t._messageRef.child(e).limitToLast(t._options.numMaxMessages).on("child_added",function(n){t._onNewMessage(e,n)},function(){t.leaveRoom(e)},t),t._messageRef.child(e).limitToLast(t._options.numMaxMessages).on("child_removed",function(n){t._onRemoveMessage(e,n)},function(){},t)},function(){},t)}})},e.prototype.leaveRoom=function(e){var t=this,n=t._firechatRef.child("room-users").child(e);if(t._messageRef.child(e).off(),t._user){var a=n.child(t._userId).child(t._sessionId);t._removePresenceOperation(a,null),t._userRef.child("rooms").child(e).remove()}delete t._rooms[e],t._onLeaveRoom(e)},e.prototype.sendMessage=function(e,t,n,a){var r,i=this,s={userId:i._userId,name:i._userName,timestamp:firebase.database.ServerValue.TIMESTAMP,message:t,type:n||"default"};return i._user?(r=i._messageRef.child(e).push(),void r.setWithPriority(s,firebase.database.ServerValue.TIMESTAMP,a)):(i._onAuthRequired(),void(a&&a(new Error("Not authenticated or user not set!"))))},e.prototype.deleteMessage=function(e,t,n){var a=this;a._messageRef.child(e).child(t).remove(n)},e.prototype.toggleUserMute=function(e,t){var n=this;return n._user?void n._userRef.child("muted").child(e).transaction(function(e){return!e||null},t):(n._onAuthRequired(),void(t&&t(new Error("Not authenticated or user not set!"))))},e.prototype.sendSuperuserNotification=function(e,t,n,a){var r=this,i=r._firechatRef.child("users").child(e).child("notifications");i.push({fromUserId:r._userId,timestamp:firebase.database.ServerValue.TIMESTAMP,notificationType:t,data:n||{}},a)},e.prototype.warnUser=function(e){var t=this;t.sendSuperuserNotification(e,"warning")},e.prototype.suspendUser=function(e,t,n){var a=this,r=(new Date).getTime()+1e3*t;a._suspensionsRef.child(e).set(r,function(t){return t&&n?n(t):(a.sendSuperuserNotification(e,"suspension",{suspendedUntil:r}),n(null))})},e.prototype.inviteUser=function(e,t){var n=this,a=function(){var a=n._firechatRef.child("users").child(e).child("invites").push();a.set({id:a.key,fromUserId:n._userId,fromUserName:n._userName,roomId:t}),a.on("value",n._onFirechatInviteResponse,function(){},n)};return n._user?void n.getRoom(t,function(r){if("private"===r.type){var i=n._roomRef.child(t).child("authorizedUsers");i.child(e).set(!0,function(e){e||a()})}else a()}):void n._onAuthRequired()},e.prototype.acceptInvite=function(e,t){var n=this;n._userRef.child("invites").child(e).once("value",function(a){var r=a.val();return null===r&&t?t(new Error("acceptInvite("+e+"): invalid invite id")):(n.enterRoom(r.roomId),void n._userRef.child("invites").child(e).update({status:"accepted",toUserName:n._userName},t))},n)},e.prototype.declineInvite=function(e,t){var n=this,a={status:"declined",toUserName:n._userName};n._userRef.child("invites").child(e).update(a,t)},e.prototype.getRoomList=function(e){var t=this;t._roomRef.once("value",function(t){e(t.val())})},e.prototype.getUsersByRoom=function(){var e=this,n=arguments[0],a=e._firechatRef.child("room-users").child(n),r=arguments[arguments.length-1],i=null;arguments.length>2&&(i=arguments[1]),a=i?a.limitToLast(i):a,a.once("value",function(e){var n=e.val()||{},a={};for(var i in n)for(var s in n[i]){a[i]=n[i][s];break}t.setTimeout(function(){r(a)},0)})},e.prototype.getUsersByPrefix=function(e,n,a,r,i){var s=this._usersOnlineRef,o=e.toLowerCase();s=n?s.startAt(null,n):a?s.endAt(null,a):o?s.startAt(null,o):s.startAt(),s=r?s.limitToLast(r):s,s.once("value",function(n){var a=n.val()||{},r={};for(var s in a){var c,l,u=a[s];for(var h in u){c=u[h].name,l=u[h].id;break}e.length>0&&0!==c.toLowerCase().indexOf(o)||(r[c]={name:c,id:l})}t.setTimeout(function(){i(r)},0)})},e.prototype.getRoom=function(e,t){this._roomRef.child(e).once("value",function(e){t(e.val())})},e.prototype.userIsModerator=function(){return this._isModerator},e.prototype.warn=function(e){console&&(e="Firechat Warning: "+e,"function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))}}(),function(e){function t(t,n,a){if(!t)throw new Error("FirechatUI: Missing required argument `firebaseRef`");if(!n)throw new Error("FirechatUI: Missing required argument `el`");a=a||{},this._options=a,this._el=n,this._user=null,this._chat=new Firechat(t,a),this._roomQueue=[],this.maxLengthUsername=15,this.maxLengthUsernameDisplay=15,this.maxLengthRoomName=24,this.maxLengthMessage=120,this.maxUserSearchResults=100,this.urlPattern=/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,this.pseudoUrlPattern=/(^|[^\/])(www\.[\S]+(\b|$))/gim,this._renderLayout(),this.$wrapper=e("#firechat"),this.$roomList=e("#firechat-room-list"),this.$tabList=e("#firechat-tab-list"),this.$tabContent=e("#firechat-tab-content"),this.$messages={},this.$rateLimit={limitCount:10,limitInterval:1e4,limitWaitTime:3e4,history:{}},this._bindUIEvents(),this._bindDataEvents()}if(!e||parseInt(e().jquery.replace(/\./g,""),10)<170)throw new Error("jQuery 1.7 or later required!");var n=this,a=n.FirechatUI;if(n.FirechatUI=t,!self.FirechatDefaultTemplates)throw new Error("Unable to find chat templates!");t.noConflict=function(){return n.FirechatUI=a,t},t.prototype={_bindUIEvents:function(){this._bindForHeightChange(),this._bindForTabControls(),this._bindForRoomList(),this._bindForUserRoomList(),this._bindForUserSearch(),this._bindForUserMuting(),this._bindForChatInvites(),this._bindForRoomListing(),this._setupTabs(),this._setupDropdowns(),this._bindTextInputFieldLimits()},_bindDataEvents:function(){this._chat.on("user-update",this._onUpdateUser.bind(this)),this._chat.on("room-enter",this._onEnterRoom.bind(this)),this._chat.on("room-exit",this._onLeaveRoom.bind(this)),this._chat.on("message-add",this._onNewMessage.bind(this)),this._chat.on("message-remove",this._onRemoveMessage.bind(this)),this._chat.on("room-invite",this._onChatInvite.bind(this)),this._chat.on("room-invite-response",this._onChatInviteResponse.bind(this)),this._chat.on("notification",this._onNotification.bind(this))},_renderLayout:function(){var t=FirechatDefaultTemplates["templates/layout-full.html"];e(this._el).html(t({maxLengthUsername:this.maxLengthUsername}))},_onUpdateUser:function(t){this._user=t;var n=this._user.muted||{};e('[data-event="firechat-user-mute-toggle"]').each(function(t,a){var r=e(this).closest("[data-user-id]").data("user-id");e(this).toggleClass("red",!!n[r])});for(var a in n)e('.message[data-user-id="'+a+'"]').fadeOut()},_onEnterRoom:function(e){this.attachTab(e.id,e.name)},_onLeaveRoom:function(e){this.removeTab(e),this._roomQueue.length>0&&this._chat.enterRoom(this._roomQueue.shift(e))},_onNewMessage:function(e,t){var n=t.userId;this._user&&this._user.muted&&this._user.muted[n]||this.showMessage(e,t)},_onRemoveMessage:function(e,t){this.removeMessage(e,t)},_onChatInvite:function(e){var t=this,n=FirechatDefaultTemplates["templates/prompt-invitation.html"],a=this.prompt("Invite",n(e));a.find("a.close").click(function(){return a.remove(),t._chat.declineInvite(e.id),!1}),a.find("[data-toggle=accept]").click(function(){return a.remove(),t._chat.acceptInvite(e.id),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),t._chat.declineInvite(e.id),!1})},_onChatInviteResponse:function(e){if(e.status){var t,n=this,a=FirechatDefaultTemplates["templates/prompt-invite-reply.html"];e.status&&"accepted"===e.status?(t=this.prompt("Accepted",a(e)),this._chat.getRoom(e.roomId,function(t){n.attachTab(e.roomId,t.name)})):t=this.prompt("Declined",a(e)),t.find("a.close").click(function(){return t.remove(),!1})}},_onNotification:function(e){if("warning"===e.notificationType)this.renderAlertPrompt("Warning","You are being warned for inappropriate messaging. Further violation may result in temporary or permanent ban of service.");else if("suspension"===e.notificationType){var t=e.data.suspendedUntil,n=Math.round((t-(new Date).getTime())/1e3),a="";if(n>0){if(n>7200){var r=Math.floor(n/3600);a=r+" hours, ",n-=3600*r}a+=Math.floor(n/60)+" minutes",this.renderAlertPrompt("Suspended","A moderator has suspended you for violating site rules. You cannot send messages for another "+a+".")}}}},t.prototype.setUser=function(e,t){var n=this;n._chat.setUser(e,t,function(e){n._user=e,n._chat.userIsModerator()&&n._bindSuperuserUIEvents(),n._chat.resumeSession()})},t.prototype.on=function(e,t){this._chat.on(e,t)},t.prototype._bindSuperuserUIEvents=function(){var t=this,n=function(t){var n=e(this),a=n.closest("[data-message-id]").data("message-id"),r=e('[data-message-id="'+a+'"]').closest("[data-user-id]").data("user-id"),i=e('[data-message-id="'+a+'"]').closest("[data-room-id]").data("room-id");return{messageId:a,userId:r,roomId:i}},a=function(){e('[data-toggle="firechat-contextmenu"]').each(function(){e(this).remove()}),e("#firechat .message.highlighted").each(function(){e(this).removeClass("highlighted")})},r=function(r){var i,s=e(this),o=s.closest("[data-message-id]"),c=FirechatDefaultTemplates["templates/message-context-menu.html"],l=n.call(this,r);r.preventDefault(),a(),s.addClass("highlighted"),t._chat.getRoom(l.roomId,function(n){i=e(c({id:o.data("message-id")})),i.css({left:r.clientX,top:r.clientY}).appendTo(t.$wrapper)})};e(document).bind("click",{self:this},function(e){e.button&&2==e.button||a()}),e(document).delegate('[data-class="firechat-message"]',"contextmenu",r),e(document).delegate('[data-event="firechat-user-warn"]',"click",function(e){var a=n.call(this,e);t._chat.warnUser(a.userId)}),e(document).delegate('[data-event="firechat-user-suspend-hour"]',"click",function(e){var a=n.call(this,e);t._chat.suspendUser(a.userId,3600)}),e(document).delegate('[data-event="firechat-user-suspend-day"]',"click",function(e){var a=n.call(this,e);t._chat.suspendUser(a.userId,86400)}),e(document).delegate('[data-event="firechat-message-delete"]',"click",function(e){var a=n.call(this,e);t._chat.deleteMessage(a.roomId,a.messageId)})},t.prototype._bindForHeightChange=function(){var t=e(this._el),n=null;setInterval(function(){var a=t.height();a!=n&&(n=a,e(".chat").each(function(e,t){}))},500)},t.prototype._bindForTabControls=function(){var t=this;e(document).delegate('[data-event="firechat-close-tab"]',"click",function(n){var a=e(this).closest("[data-room-id]").data("room-id");return t._chat.leaveRoom(a),!1})},t.prototype._bindForRoomList=function(){var t=this;e("#firechat-btn-rooms").bind("click",function(){if(!e(this).parent().hasClass("open")){var n=(e(this),FirechatDefaultTemplates["templates/room-list-item.html"]),a=function(){var n=e(this).parent(),a=n.data("room-id"),r=n.data("room-name");return t.$messages[a]?t.focusTab(a):t._chat.enterRoom(a,r),!1};t._chat.getRoomList(function(r){t.$roomList.empty();for(var i in r){var s=r[i];if("public"==s.type){s.isRoomOpen=!!t.$messages[s.id];var o=e(n(s));o.children("a").bind("click",a),t.$roomList.append(o.toggle(!0))}}})}})},t.prototype._bindForUserRoomList=function(){var t=this;e(document).delegate('[data-event="firechat-user-room-list-btn"]',"click",function(n){n.stopPropagation();var a=e(this),r=a.closest("[data-room-id]").data("room-id"),i=FirechatDefaultTemplates["templates/room-user-list-item.html"],s=a.data("target"),o=e("#"+s);o.empty(),t._chat.getUsersByRoom(r,function(n){for(var a in n)user=n[a],user.disableActions=!t._user||user.id===t._user.id,user.nameTrimmed=t.trimWithEllipsis(user.name,t.maxLengthUsernameDisplay),user.isMuted=t._user&&t._user.muted&&t._user.muted[user.id],o.append(e(i(user)));t.sortListLexicographically("#"+s)})})},t.prototype._bindForUserSearch=function(){var t=this,n=function(t){var n=e(this),r=n.data("target"),i=n.data("controls"),s=n.data("template"),o=n.val()||n.data("prefix")||"",c=n.data("startAt")||null,l=n.data("endAt")||null;t.preventDefault(),a(r,s,i,o,c,l)},a=function(n,a,r,i,s,o){var c=e("#"+n),l=e("#"+r),u=FirechatDefaultTemplates[a];t._chat.getUsersByPrefix(i,s,o,t.maxUserSearchResults,function(e){var n,a,r,s,o,h=0;c.empty();for(r in e){var f=e[r];if(f.disableActions=!t._user||f.id===t._user.id,h+=1,c.append(u(f)),1===h)s=f.name.toLowerCase();else if(h>=t.maxUserSearchResults){o=f.name.toLowerCase();break}}l&&(n=l.find('[data-toggle="firechat-pagination-prev"]'),a=l.find('[data-toggle="firechat-pagination-next"]'),o?a.data("event","firechat-user-search").data("startAt",o).data("prefix",i).removeClass("disabled").removeAttr("disabled"):a.data("event",null).data("startAt",null).data("prefix",null).addClass("disabled").attr("disabled","disabled"))})};e(document).delegate('[data-event="firechat-user-search"]',"keyup",n),e(document).delegate('[data-event="firechat-user-search"]',"click",n),e(document).delegate('[data-event="firechat-user-search-btn"]',"click",function(t){t.stopPropagation();var n=e(this).next("div.firechat-dropdown-menu").find("input");n.focus(),n.trigger(jQuery.Event("keyup"))}),e(document).delegate('[data-event="firechat-user-search"]',"click",function(e){e.stopPropagation()})},t.prototype._bindForUserMuting=function(){var t=this;e(document).delegate('[data-event="firechat-user-mute-toggle"]',"click",function(n){var a=e(this),r=a.closest("[data-user-id]").data("user-id"),i=a.closest("[data-user-name]").data("user-name"),s=a.hasClass("red"),o=FirechatDefaultTemplates["templates/prompt-user-mute.html"];if(n.preventDefault(),s)t._chat.toggleUserMute(r);else{var c=t.prompt("Mute User?",o({userName:i}));c.find("a.close").first().click(function(){return c.remove(),!1}),c.find("[data-toggle=decline]").first().click(function(){return c.remove(),!1}),c.find("[data-toggle=accept]").first().click(function(){return t._chat.toggleUserMute(r),c.remove(),!1})}})},t.prototype._bindForChatInvites=function(){var t=this,n=function(n){var a,r=e(this),i=r.closest("[data-user-id]").data("user-id"),s=r.closest("[data-room-id]").data("room-id"),o=r.closest("[data-user-name]").data("user-name"),c=FirechatDefaultTemplates["templates/prompt-invite-private.html"];return t._chat.getRoom(s,function(e){return a=t.prompt("Invite",c({userName:o,roomName:e.name})),a.find("a.close").click(function(){return a.remove(),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),!1}),a.find("[data-toggle=accept]").first().click(function(){return a.remove(),t._chat.inviteUser(i,s,e.name),!1}),!1}),!1},a=function(n){var a,r=e(this),i=r.closest("[data-user-id]").data("user-id"),s=r.closest("[data-user-name]").data("user-name"),o=FirechatDefaultTemplates["templates/prompt-invite-private.html"];return i&&s&&(a=t.prompt("Private Invite",o({userName:s,roomName:"Private Chat"})),a.find("a.close").click(function(){return a.remove(),!1}),a.find("[data-toggle=decline]").click(function(){return a.remove(),!1}),a.find("[data-toggle=accept]").first().click(function(){a.remove();var e="Private Chat";return t._chat.createRoom(e,"private",function(n){t._chat.inviteUser(i,n,e)}),!1})),!1};e(document).delegate('[data-event="firechat-user-chat"]',"click",a),e(document).delegate('[data-event="firechat-user-invite"]',"click",n)},t.prototype._bindForRoomListing=function(){var t=this,n=e("#firechat-btn-create-room-prompt"),a=e("#firechat-btn-create-room");n.bind("click",function(e){return t.promptCreateRoom(),!1}),a.bind("click",function(n){var a=e("#firechat-input-room-name").val();return e("#firechat-prompt-create-room").remove(),t._chat.createRoom(a),!1})},t.prototype._setupTabs=function(){var t=function(t){var a,r,i=t,s=i.closest("ul:not(.firechat-dropdown-menu)"),o=i.attr("data-target"),c=s.find(".active:last a")[0];o||(o=i.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),i.parent("li").hasClass("active")||(r=e.Event("show",{relatedTarget:c}),i.trigger(r),r.isDefaultPrevented()||(a=e(o),n(i.parent("li"),s),n(a,a.parent(),function(){i.trigger({type:"shown",relatedTarget:c})})))},n=function(t,n,a){function r(){i.removeClass("active").find("> .firechat-dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?t.addClass("in"):t.removeClass("fade"),t.parent(".firechat-dropdown-menu")&&t.closest("li.firechat-dropdown").addClass("active"),a&&a()}var i=n.find("> .active"),s=a&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,r):r(),i.removeClass("in")};e(document).delegate('[data-toggle="firechat-tab"]',"click",function(n){n.preventDefault(),t(e(this))})},t.prototype._setupDropdowns=function(){var t=function(t){var r=e(this),i=a(r),s=i.hasClass("open");if(!r.is(".disabled, :disabled"))return n(),s||i.toggleClass("open"),r.focus(),!1},n=function(){e("[data-toggle=firechat-dropdown]").each(function(){a(e(this)).removeClass("open")})},a=function(t){var n,a=t.attr("data-target");return a||(a=t.attr("href"),a=a&&/#/.test(a)&&a.replace(/.*(?=#[^\s]*$)/,"")),n=a&&"#"!==a&&e(a),n&&n.length||(n=t.parent()),n};e(document).bind("click",n).delegate(".firechat-dropdown-menu","click",function(e){e.stopPropagation()}).delegate("[data-toggle=firechat-dropdown]","click",t)},t.prototype._bindTextInputFieldLimits=function(){e("body").delegate('input[data-provide="limit"], textarea[data-provide="limit"]',"keyup",function(t){var n=e(this),a=e(n.data("counter")),r=n.attr("maxlength"),i=n.val().length;a.html(Math.max(0,r-i))})},t.prototype.renderAlertPrompt=function(e,t){var n=FirechatDefaultTemplates["templates/prompt-alert.html"],a=this.prompt(e,n({message:t}));a.find(".close").click(function(){return a.remove(),!1})},t.prototype.toggleInputs=function(t){e("#firechat-tab-content textarea").each(function(){var n=e(this);t?e(this).val(""):e(this).val("You have exceeded the message limit, please wait before sending."),n.prop("disabled",!t)}),e("#firechat-input-name").prop("disabled",!t)},t.prototype.attachTab=function(t,n){var a=this;if(this.$messages[t])return void this.focusTab(t);var r={id:t,name:n},i=FirechatDefaultTemplates["templates/tab-content.html"],s=e(i(r));this.$tabContent.prepend(s);var o=e("#firechat-messages"+t);this.$messages[t]=o;var c=s.find("textarea").first();c.bind("keydown",function(e){var n=a.trimWithEllipsis(c.val(),a.maxLengthMessage);if(13===e.which&&""!==n)return c.val(""),a._chat.sendMessage(t,n),!1});var l=FirechatDefaultTemplates["templates/tab-menu-item.html"],u=e(l(r));this.$tabList.prepend(u),u.bind("shown",function(e){o.scrollTop(o[0].scrollHeight)});var h=this.$tabList.children("li"),f=Math.floor(e("#firechat-tab-list").width()/h.length);this.$tabList.children("li").css("width",f),this.$roomList.children("[data-room-id="+t+"]").children("a").addClass("highlight"),e("#firechat-btn-room-user-list-"+t).bind("click",function(){return a.sortListLexicographically("#firechat-room-user-list-"+t),!1}),this.focusTab(t)},t.prototype.focusTab=function(e){if(this.$messages[e]){var t=this.$tabList.find("[data-room-id="+e+"]").find("a");t.length&&t.first().trigger("click")}},t.prototype.removeTab=function(t){delete this.$messages[t],this.$tabContent.find("[data-room-id="+t+"]").remove(),this.$tabList.find("[data-room-id="+t+"]").remove();var n=this.$tabList.children("li"),a=Math.floor(e("#firechat-tab-list").width()/n.length);this.$tabList.children("li").css("width",a),this.$tabList.find('[data-toggle="firechat-tab"]').first().trigger("click"),this.$roomList.children("[data-room-id="+t+"]").children("a").removeClass("highlight")},t.prototype.showMessage=function(t,n){var a=this,r={id:n.id,localtime:a.formatTime(n.timestamp),message:n.message||"",userId:n.userId,name:n.name,type:n.type||"default",isSelfMessage:a._user&&n.userId==a._user.id,disableActions:!a._user||n.userId==a._user.id};r.message=_.map(r.message.split(" "),function(e){return a.urlPattern.test(e)||a.pseudoUrlPattern.test(e)?a.linkify(encodeURI(e)):_.escape(e)}).join(" "),r.message=a.trimWithEllipsis(r.message,a.maxLengthMessage);var i=FirechatDefaultTemplates["templates/message.html"],s=e(i(r)),o=a.$messages[t];if(o){var c=!1;o.scrollTop()/(o[0].scrollHeight-o[0].offsetHeight)>=.95?c=!0:o[0].scrollHeight<=o.height()&&(c=!0),o.append(s),c&&o.scrollTop(o[0].scrollHeight)}},t.prototype.removeMessage=function(t,n){e('.message[data-message-id="'+n+'"]').remove()},t.prototype.sortListLexicographically=function(t){e(t).children("li").sort(function(t,n){var a=e(t).text().toUpperCase(),r=e(n).text().toUpperCase();return a<r?-1:a>r?1:0}).appendTo(t)},t.prototype.trimWithEllipsis=function(e,t){return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),t&&e.length<=t?e:e.substring(0,t)+"..."},t.prototype.formatTime=function(e){var t=e?new Date(e):new Date,n=t.getHours()||12,a=""+t.getMinutes(),r=t.getHours()>=12?"pm":"am";return n=n>12?n-12:n,a=a.length<2?"0"+a:a,""+n+":"+a+r},t.prototype.promptCreateRoom=function(){var e=this,t=FirechatDefaultTemplates["templates/prompt-create-room.html"],n=this.prompt("Create Public Room",t({maxLengthRoomName:this.maxLengthRoomName,isModerator:e._chat.userIsModerator()}));n.find("a.close").first().click(function(){return n.remove(),!1}),n.find("[data-toggle=submit]").first().click(function(){var t=n.find("[data-input=firechat-room-name]").first().val();return""!==t&&(e._chat.createRoom(t,"public"),n.remove()),!1}),n.find("[data-input=firechat-room-name]").first().focus(),n.find("[data-input=firechat-room-name]").first().bind("keydown",function(t){if(13===t.which){var a=n.find("[data-input=firechat-room-name]").first().val();if(""!==a)return e._chat.createRoom(a,"public"),n.remove(),!1}})},t.prototype.prompt=function(t,n){var a,r=FirechatDefaultTemplates["templates/prompt.html"];return a=e(r({title:t,content:n})).css({top:this.$wrapper.position().top+.333*this.$wrapper.height(),left:this.$wrapper.position().left+.125*this.$wrapper.width(),width:.75*this.$wrapper.width()}),this.$wrapper.append(a.removeClass("hidden")),a},t.prototype.linkify=function(e){var t=this;return e.replace(t.urlPattern,'<a target="_blank" href="$&">$&</a>').replace(t.pseudoUrlPattern,'$1<a target="_blank" href="http://$2">$2</a>')}}(jQuery);