<html><head><link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/google-map/google-map.html">
<link rel="import" href="../bower_components/google-map/google-map-directions.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-chip/paper-chip.html">
<link rel="import" href="shop-common-styles.html">
<link rel="import" href="shop-list-menu.html">

<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">





</head><body><dom-module id="shop-base">
  <template>
    <style include="shop-common-styles">

      .hero-image {
        position: relative;
        height: 320px;
        overflow: hidden;
        margin-bottom: 32px;
      }

      google-map {
        height: 600px;
      }

      .hero-image {
        --shop-image-img: {
          position: absolute;
          top: 0;
          bottom: 0;
          left: -9999px;
          right: -9999px;
          max-width: none;
        };
      }

      paper-tabs {
        @apply(--layout-center);
        --paper-tab-ink: #E57373;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        width: 35%;
        text-transform: uppercase;
        margin-bottom: 3px;

      }

      #menu {

      }
      .footer{
        @apply(--layout-fixed-bottom);
        height: 64px;
        background-color: white;

      }

      #message-input{
        @apply(--layout-fixed-bottom);
        height: 64px;
        z-index: 1;
        color: white;
      }

      paper-tab.iron-selected {
        color: #E57373;

      }

      paper-tab {
      --paper-tab-ink: #E57373;
      }

      --paper-tab-ink: #E57373;

      .grid {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        @apply(--layout-justified);
        margin: 0 10px 32px 10px;
        padding: 0;
        list-style: none;
      }

      .grid li {
        -webkit-flex: 1 1;
        flex: 1 1;
        -webkit-flex-basis: 33%;
        flex-basis: 33%;
        max-width: 33%;
      }

      .grid a {
        display:block;
        text-decoration: none;
      }

      .list {
       @apply(--layout-flex);
       overflow: auto;
     }

      @media (max-width: 767px) {
        .hero-image {
          display: none;
        }
        .grid{
          @apply(--layout-vertical);
        }

        .grid  li {
          -webkit-flex-basis: 100%;
          flex-basis: 100%;
          max-width: 100%;
        }
        paper-tabs {
          @apply(--layout-center);
          font-family: 'Roboto', 'Noto', sans-serif;
          -webkit-font-smoothing: antialiased;
          width: 75%;
          text-transform: uppercase;
          margin-bottom: 1px;
        }
      }
    </style>

    <app-route route="[[route]]" pattern="/:shop" data="{{routeData}}" tail="{{subroute}}">
    </app-route>

    <firebase-query id="query" path="/items" data="{{items}}" order-by-child="/shopName" start-at="{{routeData.shop}}" end-at="{{routeData.shop}}">
    </firebase-query>

    <firebase-query id="queryAddress" path="/shops" order-by-child="/shopName" start-at="{{routeData.shop}}" end-at="{{routeData.shop}}" data="{{shopData}}">
    </firebase-query>

    <firebase-query id="menuTags" path="/tags" data="{{tags}}" order-by-child="/shopName" start-at="[[routeData.shop]]" end-at="[[routeData.shop]]" limit-to-first="10">
    </firebase-query>

    <firebase-query id="shopMessage" path="/shopMessage/[[routeData.shop]]" data="{{shopMessage}}" order-by-child="/chatTime" limit-to-last="10">
    </firebase-query>


      <app-header role="navigation" id="header" effects="waterfall" condenses="" reveals="">
        <div class="layout horizontal center-justified">
        <paper-tabs selected="{{selected}}" no-bar="">
          <paper-tab>Menu</paper-tab>
          <paper-tab>About</paper-tab>
          <paper-tab>Maps</paper-tab>
          <paper-tab>Chat</paper-tab>
        </paper-tabs>
      </div>
      </app-header>

      <iron-pages selected="{{selected}}">
        <div>
          <div class="layout horizontal center-justified">
            <paper-tabs id="menu" scrollable="" selected="{{displayTag}}" no-bar="" attr-for-selected="label">
                <template is="dom-repeat" items="[[tags]]" as="tag">
                  <paper-tab label="{{tag.tag}}">[[tag.tag]]</paper-tab>
                </template>
            </paper-tabs>
        </div>
          <iron-pages selected="{{displayTag}}" attr-for-selected="name">
            <div name="{{displayTag}}">
            <ul class="grid">
              <template is="dom-repeat" items="[[items]]" as="item" filter="{{computeFilterTags(displayTag)}}">
                <li>
                  [[item.name]]
                  <a href$="[[_getItemHref(item)]]">
                    <shop-list-menu item="[[item]]"></shop-list-menu>
                  </a>
                </li>
              </template>
            </ul>
          </div>
        </iron-pages>
      </div>
        <div>
          [[shopAbout]]
        </div>

        <div>
          <google-map id="map" map="{{map}}" atitude="35.6895" longitude="139.6917" api-key="AIzaSyA_tK6zo3FBiuiXoXocS_-qLTS0KDyVd5E" zoom="15 " fit-to-markers="">
            <template is="dom-repeat" items="[[shopData]]" as="shop">
              <google-map-marker style="transit-layer" map="[[map]]" latitude="{{shop.shopLat}}" longitude="{{shop.shopLng}}" title="{[routeData.shop}}" draggable="false"></google-map-marker>
            </template>
          </google-map>
        </div>

        <div>

          <div>

           <div class="list">
           <template is="dom-repeat" items="[[shopMessage]]" as="message">
             <paper-item>
              <paper-item-body two-line="">
                <div>{{message.displayName}}</div>
                <div secondary="">{{message.chatText}}</div>
              </paper-item-body>
            </paper-item>
           </template>

         </div>
             <paper-material elevation="1" class="footer">
                 <paper-input id="message-input" label="New Message:" on-keyup="_handleInput"></paper-input>
             </paper-material>
          </div>
        </div>
      </iron-pages>

  </template>

  <script>Polymer({is:"shop-base",ready:function(){this.selected=this.shopTags},properties:{category:Object,shopName:String,visible:Boolean,route:Object,routeData:Object,item:Object,menuTitles:Object,addressQueryResult:{type:Array,notify:!0},shopAbout:{type:String,notify:!0},shopAddress:{type:Number,notify:!0},shopLat:{type:String,notify:!0},displayTag:{type:String,notify:!0},messageTextCheck:{type:String,notify:!0},shopLong:{type:String,notify:!0}},observers:["_shopChanged(routeData.shop)"],ready:function(){document.title=this.routeData.shop+" - SHOP",shopName=this.routeData.shop,this.menuTitles=[{name:"menu",title:"Our Offerings"},{name:"about",title:"About Us"},{name:"location",title:"Our Location"},{name:"chat",title:"Chat with Us"}]},_getListItems:function(e){return e||[{},{},{},{},{},{},{},{},{},{}]},_getItemHref:function(e){return console.log(this.displayTag),e.shopName?["/detail",e.shopName,e.itemName,e.itemid].join("/"):null},_shopChanged:function(e){this.debounce("change-shop",function(){this.fire("change-shop",{shopName:e.toUpperCase()})})},_getPluralizedQuantity:function(e){if(!e)return"";var t=1===e?"item":"items";return"("+e+" "+t+")"},_notifyNetworkStatus:function(){var e=this.offline;this.offline=!navigator.onLine,(this.offline||!this.offline&&e===!0)&&(this._networkSnackbar||(this._networkSnackbar=document.createElement("shop-snackbar"),Polymer.dom(this.root).appendChild(this._networkSnackbar)),Polymer.dom(this._networkSnackbar).innerHTML=this.offline?"You are offline":"You are online",this._networkSnackbar.open())},computeFilterTags:function(e){return e?(e=e.toLowerCase(),function(t){var a=t.shopsTags.toLowerCase(),o=t.shopsTags.toLowerCase();return a.indexOf(e)!=-1||o.indexOf(e)!=-1}):null},_handleInput:function(e){if(13==e.keyCode){var t=(new Date).getTime(),a=e.target.value,o=firebase.auth().currentUser,i=this.routeData.shop;if(null!=o&&0==!this.routeData.shop&&0==!e.target.value){var n=firebase.database().ref().child("/shopMessage/"+this.routeData.shop).push().key,s={},r={userid:o.uid,displayName:o.displayName,chatTime:t,chatText:a};s["/shopMessage/"+i+"/"+n]=r,firebase.database().ref().update(s)}e.target.value=""}},_toggleDrawer:function(){this.drawerOpened=!this.drawerOpened}});</script>

</dom-module>
</body></html>